module.exports=function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,e,n){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=13)}([function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={mongodbAuth:{dbuser:"spencers",dbpassword:"spencers1234",host:"ds133261.mlab.com",port:"33261",database:"spencers"},serverPort:5e3,expenseCollectionName:"expenses"}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(12),u=n(0),s=r(u),c=function(){function t(){o(this,t);var e=s.default.mongodbAuth;this.connectionString="mongodb://"+e.dbuser+":"+e.dbpassword+"@"+e.host+":"+e.port+"/"+e.database,this.getDB=this.getDB.bind(this),this.getConnection=this.getConnection.bind(this)}return i(t,[{key:"getDB",value:function(){var t=this;return new Promise(function(e,n){a.MongoClient.connect(t.connectionString,function(t,r){return t?n(t):e(r)})})}},{key:"getConnection",value:function(){return this.getDB().then(function(t){return t}).catch(function(t){return t})}}]),t}();e.default=c},function(t,e){t.exports=require("lodash")},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(11),u=r(a),s=n(0),c=r(s),l=n(1),f=r(l),d=function(){function t(){o(this,t),this.crud=new u.default,this.db=new f.default,this.get=this.get.bind(this),this.del=this.del.bind(this),this.post=this.post.bind(this),this.collectionName=c.default.expenseCollectionName}return i(t,[{key:"post",value:function(t,e){var n=this,r=t.body;this.db.getConnection().then(function(t){return n.crud.save(t.collection(n.collectionName),r)}).then(function(){return e.status(200).send(JSON.stringify({message:"Expense has been added"}))}).catch(function(){return e.status(500).send(JSON.stringify({serverError:"Expense is not added"}))})}},{key:"get",value:function(t,e){var n=this,r=t.query.id,o={};r&&"string"==typeof r&&(o.$where="this._id == '"+r+"'"),this.db.getConnection().then(function(t){return n.crud.read(t.collection(n.collectionName),o)}).then(function(t){return e.status(200).send(JSON.stringify({data:t,message:"All data fetched"}))}).catch(function(){return e.status(500).send({serverError:"Error in getting data"})})}},{key:"del",value:function(t,e){var n=this,r=t.query.id;if(!r||"string"!=typeof r)return void e.status(500).send({serverError:"Type of id should be string."});var o={$where:"this._id == '"+r+"'"};this.db.getConnection().then(function(t){return n.crud.remove(t.collection(n.collectionName),o)}).then(function(){return e.status(200).send(JSON.stringify({message:"Succefully deleted"}))}).catch(function(){return e.status(500).send({serverError:"Error in deleting entry"})})}}]),t}();e.default=d},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(2),c=r(s),l=n(10),f=r(l),d=n(8),h=r(d),g=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),u(e,[{key:"getWeeklyStatsParams",value:function(t){var e=c.default.cloneDeep(f.default);return e[2].$match.category=t,e}},{key:"getDistintCategory",value:function(t,e){var n=this;this.db.getConnection().then(function(t){return t.collection(n.collectionName).distinct("category")}).then(function(t){return e.status(200).send(JSON.stringify({data:t,message:"Fetched all category"}))}).catch(function(){return e.status(500).send(JSON.stringify({serverError:"Error in getting categories"}))})}},{key:"getDailyStats",value:function(t,e){var n=t.query.category,r=this.getDailyStatsParams(n);this.aggregateCollections(r).then(this.formatAggregatedStats).then(function(t){return e.status(200).send(JSON.stringify({data:t,message:"Day stats fetched"}))}).catch(function(){return e.status(500).send(JSON.stringify({serverError:"Error in fetching day stats"}))})}},{key:"getMonthlyStats",value:function(t,e){var n=t.query.category,r=this.getMonthlyStatsParams(n);this.aggregateCollections(r).then(this.formatAggregatedStats).then(function(t){return e.status(200).send(JSON.stringify({data:t,message:"Monthly stats fetched"}))}).catch(function(){return e.status(500).send(JSON.stringify({serverError:"Error in fetching monthly stats"}))})}},{key:"getWeeklyStats",value:function(t,e){var n=this,r=t.query.category,o=this.getWeeklyStatsParams(r);this.db.getConnection().then(function(t){return t.collection(n.collectionName).aggregate(o)}).then(function(t){return t.toArray()}).then(this.performWeeklyAggregation).then(function(t){return e.status(200).send(JSON.stringify({data:t,message:"Monthly stats fetched"}))}).catch(function(){e.status(500).send(JSON.stringify({serverError:"Error in fetching monthly stats"}))})}}]),e}(h.default);e.default=g},function(t,e){t.exports=require("body-parser")},function(t,e){t.exports=require("express")},function(t,e){t.exports=require("path")},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(2),u=r(a),s=n(9),c=r(s),l=n(0),f=r(l),d=n(1),h=r(d),g=function(){function t(){o(this,t),this.db=new h.default,this.getDailyStats=this.getDailyStats.bind(this),this.getWeeklyStats=this.getWeeklyStats.bind(this),this.getMonthlyStats=this.getMonthlyStats.bind(this),this.getDistintCategory=this.getDistintCategory.bind(this),this.aggregateCollections=this.aggregateCollections.bind(this),this.performWeeklyAggregation=this.performWeeklyAggregation.bind(this),this.collectionName=f.default.expenseCollectionName}return i(t,[{key:"getMonthlyStatsParams",value:function(t){var e=u.default.clone(c.default);return e.matchResult.$match.category=t,e.group.$group._id.month="$month",e.sortGroup.$sort["_id.month"]=1,e}},{key:"getDailyStatsParams",value:function(t){var e=this.getMonthlyStatsParams(t);return e.project.$project.day={$substr:["$date",8,2]},e.group.$group._id.day="$day",e.sortGroup.$sort["_id.month"]=1,e}},{key:"aggregateCollections",value:function(t){var e=this;return this.db.getConnection().then(function(n){return n.collection(e.collectionName).aggregate(t.project,t.unwind,t.matchResult,t.group,t.sortGroup)}).then(function(t){return t.toArray()}).catch(function(t){return t})}},{key:"formatAggregatedStats",value:function(t){var e=["month","day"];return t.map(function(t){var n=t._id.year;return e.forEach(function(e){t._id[e]&&(n+="-"+t._id[e])}),{time:n,total:t.total}})}},{key:"mapWithWeek",value:function(t){return t.map(function(t){return t.week=parseInt(Number(t.day)/7,10)+1,t})}},{key:"formatWeeklyStats",value:function(t){var e=Object.keys(t);return e.map(function(e){var n=t[e],r=n.year+"-"+n.month+"-week("+n.week+")";return{time:r,total:n.total}})}},{key:"performWeeklyAggregation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["week","month","year"],n=this.mapWithWeek(t),r={};return n.forEach(function(t){var n="";e.forEach(function(e){n+=t[e]}),r[n]?r[n].total+=t.amount:(r[n]={},e.forEach(function(e){r[n][e]=t[e]}),r[n].total=t.amount)}),this.formatWeeklyStats(r)}}]),t}();e.default=g},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={project:{$project:{category:"$category",amount:"$amount",year:{$substr:["$date",0,4]},month:{$substr:["$date",5,2]},day:{$substr:["$date",8,2]}}},unwind:{$unwind:"$category"},matchResult:{$match:{category:""}},group:{$group:{_id:{year:"$year",category:"$category"},total:{$sum:"$amount"}}},sortGroup:{$sort:{"_id.year":1}}}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=[{$project:{category:"$category",amount:"$amount",year:{$substr:["$date",0,4]},month:{$substr:["$date",5,2]},day:{$substr:["$date",8,2]}}},{$unwind:"$category"},{$match:{category:""}}]},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(){n(this,t),this.save=this.save.bind(this),this.read=this.read.bind(this),this.find=this.find.bind(this)}return r(t,[{key:"save",value:function(t,e){return new Promise(function(n,r){t.insert(e,function(t,e){return t?r(t):n(e)})})}},{key:"find",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(r,o){t.find(e,n,function(t,e){return t?o(t):r(e)})})}},{key:"read",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.find(t,e,n).then(function(t){return t.toArray()}).then(function(t){return t}).catch(function(t){return t})}},{key:"remove",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){t.remove(e,e,function(t,e){return t?r(t):n(e)})})}}]),t}();e.default=o},function(t,e){t.exports=require("mongodb")},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var o=n(7),i=r(o),a=n(6),u=r(a),s=n(5),c=r(s),l=n(0),f=r(l),d=n(4),h=r(d),g=n(3),y=r(g),p=(0,u.default)(),v=new h.default,m=new y.default;p.set("port",process.env.PORT||f.default.serverPort),p.use("/",u.default.static(i.default.join(__dirname,"/app"))),p.use("/:pathname",u.default.static(i.default.join(__dirname,"/app"))),p.use(c.default.urlencoded({extended:!0})),p.use(c.default.json()),p.get("/spencers/expense",m.get),p.post("/spencers/expense",m.post),p.delete("/spencers/expense",m.del),p.get("/spencers/categories",v.getDistintCategory),p.get("/spencers/stats/daily",v.getDailyStats),p.get("/spencers/stats/monthly",v.getMonthlyStats),p.get("/spencers/stats/weekly",v.getWeeklyStats),p.listen(p.get("port"),function(){console.log("listening to port "+p.get("port"))})}]);